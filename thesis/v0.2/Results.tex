%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Results}
\label{chap:Results}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\comment{
The Results section should provide
\begin{itemize}
    \item An overview of all obtained results
    \item An in detail discussion/explanation of all results
    \item A scientific interpretation of the results
\end{itemize}


\section{Common attributes to pay attention to are:}
\begin{itemize}
    \item When comparing plots, keep the scale of axes consistent.  To do otherwise is misleading for the reader.
    \item If you are going to compare separate plots, consider if they can be better evaluated when combined into a single plot.
    \item When plotting data, particularly the \emph{mean}, ensure that you also plot error bars (or other method) of indicating the distribution.
    \item If a figure or plot is included, ensure it is referenced explicitly in the body text discussion.
    \item When a large table of data is included, consider whether it would be better communicated as a box-plot or something similar.
    \item All axes should be labelled and include units of measurement where applicable.
    \item All captions and figures should have captions with enough information to be understood at a glance.  Do not use captions to provide information that is better placed in the body text.  
    \item Remember to identify result outliers and anomalous data and to attempt an explanation or justification.
\end{itemize}

\
}


% 实验场景设置
\section{Experiment Design}

\subsection*{Map}
\label{chap:map}

% 本文中的所有实验在一张模拟库房场景的地图中进行。
All experiments in this paper were conducted on a map simulating a warehouse scenario.
% 此地图是从一组被广泛使用的benchmark中选出的。
This map was selected from a widely-used benchmark set\cite{stern2019mapf}\footnote{https://movingai.com/benchmarks/mapf.html} for testing, due to its appropriate size and obstacle distribution.

\begin{figure}[htbp]
    \centering
    \includegraphics*[width = \linewidth]{figures/map(color).png}
    \caption{The map used in the experiments. The outer border is not included in the map.}
    \label{fig:Map}
\end{figure}

% 地图的大小为161*63（外侧的框不是地图的一部分），图中的绿色代表障碍物，白色代表可通行。所有狭窄通道（边缘和障碍物之间的通道）均为一格/一像素宽。
The size of the map is 161$\times$63 (the outermost green frame is not part of the map), 
with green representing obstacles and white representing passable areas.
All narrow corridors (channels at the border and between obstacles) are one grid / pixel wide.

\subsection*{Agent Initialisation and Behaviour}
\label{chap:agent initialisation}
% agent的起点和终点是如何生成。。。
% 生成若干起点-终点对，保存为单独的文件，每次启动实验时从此文件中依次读入起点-终点对，并依次分配给启动的agent。
The starting points and their corresponding goal points for agents are pre-generated and stored in a launch file. 
During each experiment, all agents are started simultaneously, and then sequentially read the start-goal point pairs from this file and assign them to the agents as they are launched.
(e.g. if 50 agents are launched in a experiment run, the first 50 start-goal pairs are read from the launch file and assigned to the agents in order. The same approach is applied for different numbers of agents.)
% 如何生成的：
% 起点是位于地图最外圈的一圈可用位置（Fig4.1中的最外圈不是地图的一部分）。起点序列的顺序是随机打乱后存储在launch file中的。
The starting points are located in the outermost circle of the map (the outermost green obstacle border in Fig \ref{fig:Map} is not part of the map). The sequence of starting points is stored in the launch file after being randomly shuffled.
% 终点是跨过地图的另一侧，起点与终点的映射关系如下：
The goal points are on the opposite side of the map, and the mapping relationship between the starting points and the goal points is as follows:
\begin{align}
    x_{goal} = width(map) - x_{start}  \\
    y_{goal} = height(map) - y_{start} 
\end{align}

Where $x$ refers to the horizontal coordinate, and $y$ refers to the vertical coordinate.
% 这一映射的效果如下图所示：
The effect of this mapping is shown in the following figure:
\textbf{ADD PIC HERE} % 展示起点终点映射效果

% agent如何加入地图
% agent到达终点后的行为
% agent在成功加入网络后，尝试生成一个以给定起点起始的计划。若没有满足此要求的计划，则不存在于地图内（可视为在地图外等待）。
After successfully joining the network, the agent attempts to generate a plan starting from the given start. If no plan meeting this requirement is available, the agent is not present on the map (since the start is on the map boundary, it can be considered as waiting outside the map).
% 若在某时刻到达终点，则关机并从地图中消失（由于终点也位于地图边界，可视为退出地图）。
If the agent reaches the goal, it will shut down and disappear from the map (since the goal is also on the map boundary, it can be considered as exiting the map).

\subsection*{Parameters and Metrics}
% 算法共有四个参数：预测horizon，requied plan length, frame length, agent number
There are four adjustable parameters in the algorithm: 
\begin{enumerate}
    \item plan length limit: The upper limit of the length of the plan returned in a single planning session. Plans that exceed this length will be discarded.
    \item planning horizon: The upper limit of the future horizon that can be predicted in a single planning window, which is also the maximum length of the plan that can be generated in a single planning window.
    \item frame length: The length of the frame in the communication channel.
    \item agent number: The number of agents.
\end{enumerate}

There are five performance metrics:
\begin{enumerate}
    \item total path efficiency ratio: sum of actual path lengths / sum of optimal path lengths. 
    The optimal path is determined using A* algorithm under the assumption that there are no other agents present in the map.
    \item average path efficiency ratio: average of individual agents' (actual path length / optimal path length).
    \item final agent arrival time: the time at which the last agent reached its goal.
    \item average agent arrival time: the average arrival time for individual agents.
    \item average network join time: the average time spent by agents to join the network.
\end{enumerate}

\section{Experiment Results}
% 实验结果及讨论
% 数值结果
\subsection{Quantitative Results}

% 用数值化结果分析参数变化对系统性能的影响
Analyze the impact of parameter changes on system performance using quantitative results.


\subsubsection{plan length limit and planning horizon}

% 这两个参数主要影响生成的计划, plan length limit是返回计划长度的上限，planning horizon是可生成计划的上限
These two parameters mainly impact the generated plans. The plan length limit sets the maximum length for the returning plans, while the planning horizon determines the upper length boundary for plans that can be generated.

% 其中，planning horizon是越长越好的，因为只有在这一范围内，agent才能做出有效行动，超出这一范围则只能执行默认行为（原地待机）。
A longer planning horizon is more favorable, as it allows agents to make effective actions within this range. Beyond this scope, agents can only execute default behaviour (remaining stationary).

% plan length limit 在较长和较短时可能有不同的效果：
On the other hand, the plan length limit might have diverse effects when set to longer or shorter values:
\begin{itemize}
    \item When set to longer values: Sharing longer plans among agents, might enhance collaboration efficiency and overall effectiveness by enabling agents to coordinate over extended horizon.
    \item When set to shorter values: Sharing shorter plans among agents, could lead to more agile agent movements, potentially increasing efficiency by allowing for greater flexibility.
\end{itemize}

% 另外，plan length limit至少也应当等同于frame length, 因为计划长度短于一帧时agent会原地待机，极大降低效率。
Additionally, the plan length limit should be at least equal to the frame length. This is because when the plan length is shorter than one frame, the agent will remain stationary, significantly reducing efficiency.

% 为了验证上述猜想，进行两组实验如下：
To validate these hypotheses, two groups of experiments are conducted as follows:
\begin{itemize}
    % planning horizon = 30, plan length limit和frame length以10为步长遍历10-60的参数空间，其中plan length limit总是不小于frame length. agent number作为无关变量，保持和frame length相同。
    \item Group 1.1: agent number = frame length, planning horizon = 30, plan length limit and frame length explore a parameter space ranging from 10 to 60 in increments of 10. Notably, the plan length limit is always maintained to be greater than or equal to the frame length.
    \item Group 1.2: agent number = frame length, planning horizon = 60, plan length limit and frame length explore a parameter space ranging from 10 to 60 in increments of 10. Notably, the plan length limit is always maintained to be greater than or equal to the frame length.
\end{itemize}

% 实验中的随机因素是agent加入网络的时间，因为agent随机地选择信道中空闲槽位。
The random factor in the experiment is the time spent for agents to join the network, as agents randomly choose free slots in the channel when joining.
% 由于实验耗时较长（一槽对应1秒）对于参数空间中的每个点仅进行一次测试。
Due to the considerable time required for the experiment (one slot takes 1 second), each point in the parameter space is tested only once.
% 虽然这样无法排除部分随机性，但是实验结果中表明的趋势仍然是非常清楚的。
Although this approach doesn't eliminate all randomness, the trends indicated in the experimental results are still quite clear.

% 对于参数空间中的每个点仅


\begin{figure}[htb]
    \centering
    \begin{subfigure}[t]{1.1\linewidth}
      \centering
      \includegraphics[width = \linewidth]{figures/horizon30_plan_length_limit_vs_performance.png}
      \caption{Experiment Group 1.1: path efficiency versus plan length limit (planning horizon = 30)}
      \label{fig:horizon=30,performance/planlengthlimit}
    \end{subfigure}
    \begin{subfigure}[t]{1.1\linewidth}
        \centering
        \includegraphics[width = \linewidth]{figures/horizon60_plan_length_limit_vs_performance.png}
        \caption{Experiment Group 1.2: path efficiency versus plan length limit (planning horizon = 60)}
        \label{fig:horizon=60,performance/planlengthlimit}
      \end{subfigure}
    \caption{Performance versus Planning Horizon and Plan Length Limit.}
    \label{fig:plan_length_limit}
\end{figure}

\FloatBarrier

% Fig4.2中展示了与路径质量相关的两个metric与planning horizon及plan length limit的关系。
In Figure \ref{fig:plan_length_limit}, the relationship between two metrics (total / average path efficiency) associated with path quality and the planning horizon, as well as the plan length limit, is illustrated.
% 结果可以分为两个部分：帧长度超出planning horizon的部分和帧长度未超出planning horizon的部分。
The results can be divided into two parts: the portion where the frame length exceeds the planning horizon, and the portion where the frame length does not exceed the planning horizon.

\begin{itemize}
    \item Frame length exceeds planning horizon: 
    
    % Fig 4.2.a中的斜坡部分就是这部分的结果。此部分中的frame lengt均大于planning horizon, 也就意味着在每帧的最后一部分，agent只能原地不动。
    The slope in Figure \ref{fig:horizon=30,performance/planlengthlimit} represents this segment of results. Within this portion, the frame lengths are all greater than the planning horizon, indicating that agents remain stationary during the final part of each frame.

    % 在这部分中，frame length和planning horizon的关系对路径效率起主导作用。可以看出，不论是总路径效率还是平均路径效率，都几乎等于帧长度与planning horizon的比例（如在frame length = 60处为2.0）
    In this section, the relationship between frame length and planning horizon predominantly influences path efficiency. It's evident that both the total path efficiency and the average path efficiency nearly equal the ratio of frame length to planning horizon (as seen at frame length = 60, the ratio is near 2.0, for instance).

    \item Frame length does not exceed planning horizon: 
    
    %Fig 4.2中所有剩余的平坦部分是这部分的结果。从图中可以看出，在frame length不超出planning horizon的情况下，路径效率几乎不随plan length limit变化。图中所有平坦部分的z轴（即metric）值均低于1.05.
    In Figure \ref{fig:plan_length_limit}, all the remaining flat sections represent the results of this segment. From the graph, it's evident that when the frame length does not exceed the planning horizon, path efficiency remains almost unchanged regardless of variations in the plan length limit. The z-axis values in all these flat sections of the graph are below 1.05.
    
    % 这表明：要么是plan length limit对路径效率没有显著影响，要么是地图对于实验中运行的agent来说过于开阔。
    This indicates that either the plan length limit has negligible impact on path efficiency, or the map is too open for the agents involved in the experiment. 

    % 对于地图太开阔的解释：如\ref{chap:map}中所提到的一样，虽然所有的走廊都只能有1agent宽，但由于障碍物的特殊分布，当一条路径被阻挡时，agent可以简单地选择在不同的路口转弯，来在不损失路径效率的情况下避开被使用的走廊。
    The explanation for the map being too open: 
    As mentioned in \ref{chap:map}, although all the corridors have a width of only one agent's width (one grid / pixel), due to the specific distribution of obstacles, 
    when a path is blocked, an agent can simply choose to turn at different intersections to avoid collision, 
    this allows them to avoid the occupied corridors without sacrificing path efficiency.
    % agent的起点终点设置\ref{chap:agent initialisation}可能加剧了这一情况，因为agent均需要跨过地图，而跨过此地图的最优路线有很多种。
    The setting of agent starting and ending points, as described in \ref{chap:agent initialisation}, might contribute to this situation. All agents need to cross the map, and there are many optimal routes for crossing this map, which could exacerbate the open nature of the map.
\end{itemize}

% 总体来说，实验结果表明，对于本测试情景，plan length limit并不重要。只要frame length不超出planning horizon, 路径效率就可以保持在接近最优的水平。
Overall, these experimental results indicate that, within the context of this test scenario, the plan length limit is not a critical factor. As long as the frame length does not exceed the planning horizon, path efficiency can be maintained at a level close to optimal.

\subsubsection{frame length and agent number}


% 在某些场景中的行为
\subsection{Other Results}
        % 避障行为及讨论
        % 死锁情形